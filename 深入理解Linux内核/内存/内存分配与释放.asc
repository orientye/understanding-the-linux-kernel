:toc:
:toclevels: 5
:hardbreaks-option:

== 内存分配与释放

=== 演进
==== 伙伴分配器
https://www.kernel.org/doc/gorman/html/understand/understand009.html

==== 对象分配器
▪ SLAB
2.0
slab可以看作是内存对象池
https://en.wikipedia.org/wiki/Slab_allocation

▪ SLOB(Simple List Of Blocks)
2.6.16
比较精简，适用于嵌入式小内存小机器

▪ SLUB
2.6.22
新一代，default
https://events.static.linuxfound.org/images/stories/pdf/klf2012_kim.pdf
https://lwn.net/Articles/229984/
https://stackoverflow.com/questions/15470560/what-to-choose-between-slab-and-slub-allocator-in-linux-kernel

==== 连续内存分配器(CMA)
since 3.5
Contiguous Memory Allocator
避免预留大块内存
https://blog.51cto.com/u_15015138/2556751

=== 用户空间
==== 堆栈
alloca

==== 堆
===== malloc/calloc/realloc/free

===== brk
SYSCALL_DEFINE1(brk, unsigned long, brk):
https://github.com/torvalds/linux/blob/master/mm/mmap.c
https://github.com/torvalds/linux/blob/master/mm/nommu.c

sbrk

===== mmap/munmap
SYSCALL_DEFINE6(mmap_pgoff
https://github.com/torvalds/linux/blob/master/mm/mmap.c
https://github.com/torvalds/linux/blob/master/mm/nommu.c

    ksys_mmap_pgoff
        vm_mmap_pgoff
            do_mmap
                mmap_region

=== 内核空间
==== vmalloc/vfree

==== slab
kmalloc/kcalloc/krealloc/kfree
kmem_cache_create

==== buddy
__get_free_page/__get_free_pages
alloc_page/alloc_pages/free_pages

=== 参考
https://www.cnblogs.com/arnoldlu/p/8251333.html